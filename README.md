# Python Test Automation Framework

[![Test Automation Framework](https://github.com/lamvanbaoit/python-test-automation-framework/workflows/Test%20Automation%20Framework/badge.svg)](https://github.com/lamvanbaoit/python-test-automation-framework/actions)
[![Python](https://img.shields.io/badge/python-3.9%2B-blue.svg)](https://www.python.org/downloads/)
[![Playwright](https://img.shields.io/badge/playwright-1.44%2B-green.svg)](https://playwright.dev/)
[![Allure](https://img.shields.io/badge/allure-2.24%2B-orange.svg)](https://docs.qameta.io/allure/)

Framework test automation ho√†n ch·ªânh s·ª≠ d·ª•ng **Playwright + Pytest + Page Object Model (POM)** v·ªõi h·ªó tr·ª£ UI Testing, API Testing, gRPC Testing v√† **Allure Framework** cho report step-by-step chuy√™n nghi·ªáp.

> üöÄ **M·ªõi?** Xem [QUICK_START.md](QUICK_START.md) ƒë·ªÉ ch·∫°y nhanh trong 5 ph√∫t!

## üöÄ Features

- **UI Testing**: Playwright v·ªõi Page Object Model n√¢ng cao
- **API Testing**: REST API v·ªõi requests library
- **gRPC Testing**: gRPC client v·ªõi protobuf
- **Multi-browser**: H·ªó tr·ª£ Chromium, Firefox, WebKit
- **Multi-environment**: Dev, Staging, Production
- **Advanced Reporting**: Pytest-HTML, **Allure Framework** (step-by-step)
- **Screenshot & Logging**: T·ª± ƒë·ªông ch·ª•p screenshot khi fail
- **Parallel Execution**: Ch·∫°y test song song v·ªõi pytest-xdist
- **Common Functions**: Th∆∞ vi·ªán h√†m ti·ªán √≠ch d√πng chung
- **Allure Helpers**: Step-by-step reporting nh∆∞ ZaloPay

## üìÅ Project Structure

```
Playwright/
‚îú‚îÄ‚îÄ api_clients/           # API & gRPC clients
‚îÇ   ‚îú‚îÄ‚îÄ user_api_client.py
‚îÇ   ‚îî‚îÄ‚îÄ order_grpc_client.py
‚îú‚îÄ‚îÄ config/               # C·∫•u h√¨nh m√¥i tr∆∞·ªùng
‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îú‚îÄ‚îÄ pages/                # Page Objects
‚îÇ   ‚îú‚îÄ‚îÄ base_page.py      # Base class cho t·∫•t c·∫£ pages
‚îÇ   ‚îú‚îÄ‚îÄ login_page.py     # Login page object
‚îÇ   ‚îî‚îÄ‚îÄ locators.py       # Qu·∫£n l√Ω selector t·∫≠p trung
‚îú‚îÄ‚îÄ tests/                # Test cases
‚îÇ   ‚îú‚îÄ‚îÄ test_login_ui.py  # UI tests
‚îÇ   ‚îú‚îÄ‚îÄ test_login_ui_allure.py  # UI tests v·ªõi Allure
‚îÇ   ‚îú‚îÄ‚îÄ test_user_api.py  # API tests
‚îÇ   ‚îî‚îÄ‚îÄ test_order_grpc.py # gRPC tests
‚îú‚îÄ‚îÄ utils/                # Helper functions
‚îÇ   ‚îú‚îÄ‚îÄ helpers.py
‚îÇ   ‚îú‚îÄ‚îÄ common_functions.py # Th∆∞ vi·ªán h√†m ti·ªán √≠ch
‚îÇ   ‚îî‚îÄ‚îÄ allure_helpers.py # Allure reporting helpers
‚îú‚îÄ‚îÄ screenshots/          # Screenshots khi test fail
‚îú‚îÄ‚îÄ conftest.py           # Pytest configuration & fixtures
‚îú‚îÄ‚îÄ requirements.txt      # Dependencies
‚îî‚îÄ‚îÄ README.md
```

## üõ†Ô∏è Setup

### 1. Clone & Navigate
```bash
cd /Users/lap14947/Documents/Playwright
```

### 2. T·∫°o Virtual Environment
```bash
python3 -m venv .venv
```

### 3. K√≠ch ho·∫°t Virtual Environment
```bash
# macOS/Linux
source .venv/bin/activate

# Windows
.venv\Scripts\activate
```

### 4. C√†i ƒë·∫∑t Dependencies
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 5. C√†i ƒë·∫∑t Playwright Browsers
```bash
playwright install
```

### 6. C√†i ƒë·∫∑t Allure Framework

C√≥ 3 c√°ch c√†i ƒë·∫∑t Allure Framework:

#### **C√°ch 1: C√†i ƒë·∫∑t Global (Khuy·∫øn ngh·ªã)**
```bash
# macOS
brew install allure

# Windows
scoop install allure

# Linux
wget -qO- https://repo.maven.apache.org/maven2/io/qameta/allure/allure-commandline/2.24.0/allure-commandline-2.24.0.tgz | tar -xz -C /opt/
sudo ln -s /opt/allure-2.24.0/bin/allure /usr/bin/allure
```

#### **C√°ch 2: C√†i ƒë·∫∑t qua NPM (Local)**
```bash
# C√†i ƒë·∫∑t Node.js v√† NPM tr∆∞·ªõc
npm install --save-dev allure-commandline

# S·ª≠ d·ª•ng v·ªõi npx
npx allure --version
```

#### **C√°ch 3: C√†i ƒë·∫∑t Local trong Source Code**
```bash
# S·ª≠ d·ª•ng script t·ª± ƒë·ªông
python allure_runner.py install

# Ho·∫∑c ch·∫°y demo script (t·ª± ƒë·ªông c√†i ƒë·∫∑t)
python run_allure_demo.py
```

#### **Ki·ªÉm tra c√†i ƒë·∫∑t:**
```bash
# Global
allure --version

# NPM
npx allure --version

# Local
python allure_runner.py serve
```

## üöÄ Quick Start

### Ch·∫°y to√†n b·ªô test
```bash
pytest
```

### Ch·∫°y test c·ª• th·ªÉ
```bash
# UI Test
pytest tests/test_login_ui.py

# UI Test v·ªõi Allure
pytest tests/test_login_ui_allure.py

# API Test  
pytest tests/test_user_api.py

# gRPC Test
pytest tests/test_order_grpc.py
```

### Ch·∫°y v·ªõi t√πy ch·ªçn
```bash
# Ch·ªçn browser
pytest --test-browser=firefox

# Ch·ªçn base URL
pytest --app-base-url=https://staging.example.com

# Ch·∫°y song song
pytest -n auto
```

### Ch·∫°y theo nh√≥m test
```bash
# Smoke tests (nhanh)
pytest -m smoke

# Regression tests (ƒë·∫ßy ƒë·ªß)
pytest -m regression

# UI tests
pytest -m ui

# API tests
pytest -m api

# gRPC tests
pytest -m grpc

# Allure tests
pytest -m allure
```

## üõ†Ô∏è Development Tools

### Code Quality Tools
```bash
# Format code
python scripts/dev_tools.py format

# Lint code
python scripts/dev_tools.py lint

# Type check
python scripts/dev_tools.py type

# Ch·∫°y t·∫•t c·∫£ checks
python scripts/dev_tools.py all
```

### Test Tools
```bash
# Ch·∫°y tests nhanh
python scripts/dev_tools.py test

# Ch·∫°y smoke tests
python scripts/dev_tools.py smoke

# Ch·∫°y tests v·ªõi Allure
python scripts/dev_tools.py allure

# M·ªü Allure report
python scripts/dev_tools.py report
```

### Manual Commands
```bash
# Format code v·ªõi Black
black .

# Lint v·ªõi Flake8
flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics

# Type check v·ªõi MyPy
mypy . --ignore-missing-imports
```

## üìä Reporting

### Pytest-HTML Report
```bash
pytest --html=report.html --self-contained-html
```

### üéØ **Allure Framework Report (Step-by-Step nh∆∞ ZaloPay)**

#### Ch·∫°y test v√† t·∫°o Allure report
```bash
# Ch·∫°y test v·ªõi Allure
pytest tests/test_login_ui_allure.py --alluredir=allure-results

# Xem report
allure serve allure-results
```

#### T·∫°o report HTML static
```bash
# Generate HTML report
allure generate allure-results --clean -o allure-report

# M·ªü report
allure open allure-report
```

#### Report features:
- ‚úÖ **Step-by-step execution** nh∆∞ ZaloPay
- ‚úÖ **Screenshots t·ª± ƒë·ªông** cho m·ªói step
- ‚úÖ **Test data tracking** 
- ‚úÖ **Environment info**
- ‚úÖ **Assertion details**
- ‚úÖ **Error analysis**
- ‚úÖ **Timeline view**
- ‚úÖ **Trends & statistics**

### üìä **H∆∞·ªõng d·∫´n m·ªü Allure Report**

> üìñ **Xem h∆∞·ªõng d·∫´n chi ti·∫øt:** [OPEN_REPORT_GUIDE.md](OPEN_REPORT_GUIDE.md)

#### **üöÄ C√°ch nhanh nh·∫•t:**
```bash
# T·ª± ƒë·ªông detect v√† m·ªü
python open_allure_report.py auto

# Serve mode (real-time)
python open_allure_report.py serve

# Generate HTML
python open_allure_report.py generate
```

#### **C√°ch 1: Serve Report (Khuy·∫øn ngh·ªã cho development)**
```bash
# M·ªü report v·ªõi local server - t·ª± ƒë·ªông m·ªü browser
allure serve allure-results

# Ho·∫∑c v·ªõi NPM
npx allure serve allure-results

# Ho·∫∑c v·ªõi local runner
python allure_runner.py serve allure-results

# Ho·∫∑c v·ªõi Python script
python open_allure_report.py serve allure-results
```
- ‚úÖ **T·ª± ƒë·ªông m·ªü browser** t·∫°i `http://localhost:8080`
- ‚úÖ **Real-time updates** khi c√≥ thay ƒë·ªïi
- ‚úÖ **Kh√¥ng c·∫ßn l∆∞u file** - temporary directory
- ‚úÖ **Ph√π h·ª£p cho development** v√† testing

#### **C√°ch 2: Generate v√† M·ªü HTML Report (Khuy·∫øn ngh·ªã cho sharing)**
```bash
# B∆∞·ªõc 1: Generate HTML report
allure generate allure-results --clean -o allure-report

# B∆∞·ªõc 2: M·ªü report
allure open allure-report

# Ho·∫∑c m·ªü tr·ª±c ti·∫øp trong browser
open allure-report/index.html  # macOS
start allure-report/index.html  # Windows
xdg-open allure-report/index.html  # Linux
```
- ‚úÖ **Report ƒë∆∞·ª£c l∆∞u** trong `allure-report/` directory
- ‚úÖ **C√≥ th·ªÉ share** qua email, Slack, file hosting
- ‚úÖ **Ph√π h·ª£p cho sharing** v·ªõi team

#### **C√°ch 3: S·ª≠ d·ª•ng Demo Script**
```bash
# Ch·∫°y demo t·ª± ƒë·ªông (bao g·ªìm c√†i ƒë·∫∑t, ch·∫°y test, t·∫°o report)
python run_allure_demo.py
```

#### **C√°ch 4: S·ª≠ d·ª•ng NPM Scripts**
```bash
# Ch·∫°y test v√† t·∫°o report
npm run test:allure

# Serve report
npm run allure:serve

# Generate v√† m·ªü report
npm run allure:generate
npm run allure:open
```

### üö® **Troubleshooting m·ªü report**

#### **V·∫•n ƒë·ªÅ: Report c·ª© load v√† kh√¥ng l√™n**
**Nguy√™n nh√¢n:** CORS Policy khi m·ªü file HTML tr·ª±c ti·∫øp

**Gi·∫£i ph√°p:**
```bash
# C√°ch 1: S·ª≠ d·ª•ng HTTP Server (Khuy·∫øn ngh·ªã)
cd allure-report
python -m http.server 8080
open http://localhost:8080

# C√°ch 2: S·ª≠ d·ª•ng Allure Serve
npx allure serve allure-results

# C√°ch 3: S·ª≠ d·ª•ng Python Script
python open_allure_report.py serve allure-results
```

#### **Port 8080 b·ªã chi·∫øm:**
```bash
# D√πng port kh√°c
allure serve allure-results --port 8081
npx allure serve allure-results --port 8081
python open_allure_report.py serve allure-results 8081
```

#### **Report kh√¥ng hi·ªÉn th·ªã:**
```bash
# Clear cache v√† regenerate
rm -rf allure-results allure-report
pytest tests/ --alluredir=allure-results
allure generate allure-results --clean -o allure-report
```

#### **Browser kh√¥ng m·ªü t·ª± ƒë·ªông:**
```bash
# M·ªü th·ªß c√¥ng
open http://localhost:8080  # macOS
start http://localhost:8080  # Windows
xdg-open http://localhost:8080  # Linux
```

#### **Allure ch∆∞a c√†i ƒë·∫∑t:**
```bash
# C√†i ƒë·∫∑t global
brew install allure  # macOS

# Ho·∫∑c c√†i ƒë·∫∑t local
npm install --save-dev allure-commandline
python allure_runner.py install
```

> üîç **Xem troubleshooting chi ti·∫øt:** [OPEN_REPORT_GUIDE.md#troubleshooting](OPEN_REPORT_GUIDE.md#troubleshooting)

## üß™ Writing Tests v·ªõi Allure

### 1. UI Test v·ªõi Step-by-Step Reporting

```python
# tests/test_example_allure.py
import allure
from pages.login_page import LoginPage
from utils.allure_helpers import AllureReporter

@allure.feature("Authentication")
@allure.story("User Login")
class TestLoginWithAllure:
    
    @allure.testcase("TC001", "Login Success")
    def test_login_success_with_steps(self, page):
        # Step 1: Navigate
        AllureReporter.navigate_to("https://example.com")
        login_page = LoginPage(page)
        login_page.goto()
        
        # Step 2: Fill credentials
        AllureReporter.fill_field_step("Username", "testuser")
        AllureReporter.fill_field_step("Password", "***")
        login_page.login("testuser", "password")
        
        # Step 3: Take screenshot
        AllureReporter.take_screenshot_step(page, "After Login")
        
        # Step 4: Assert
        AllureReporter.assert_step("Login successful", True, login_page.is_logged_in())
        assert login_page.is_logged_in()
```

### 2. API Test v·ªõi Allure

```python
# tests/test_api_allure.py
from utils.allure_helpers import AllureReporter

def test_api_with_allure(api_client):
    # Step 1: Prepare request
    request_data = {"username": "test", "password": "pass"}
    AllureReporter.api_request_step("POST", "/login", request_data)
    
    # Step 2: Make request
    response = api_client.login("test", "pass")
    
    # Step 3: Log response
    AllureReporter.api_response_step(response.status_code, response.json())
    
    # Step 4: Assert
    AllureReporter.assert_step("Status code", 200, response.status_code)
    assert response.status_code == 200
```

### 3. Allure Decorators

```python
import allure

@allure.feature("Feature Name")
@allure.story("Story Name")
@allure.severity(allure.severity_level.CRITICAL)
@allure.description("Test description")
@allure.testcase("TC001", "Test Case Name")
@allure.issue("BUG-001", "https://jira.example.com/browse/BUG-001")
def test_with_allure_decorators():
    pass
```

## üìù Page Object Model

### T·∫°o Page Object m·ªõi

```python
# pages/inventory_page.py
from .base_page import BasePage
from .locators import INVENTORY_PAGE_SELECTORS

class InventoryPage(BasePage):
    def __init__(self, page, selectors=None):
        super().__init__(page)
        self.selectors = selectors or INVENTORY_PAGE_SELECTORS
    
    def add_item_to_cart(self, item_name):
        self.click_button(f"button[data-test='add-to-cart-{item_name}']")
    
    def go_to_cart(self):
        self.click_button(self.selectors["cart_button"])
```

### Th√™m Selector m·ªõi

```python
# pages/locators.py
INVENTORY_PAGE_SELECTORS = {
    "inventory_container": ".inventory_list",
    "cart_button": ".shopping_cart_link",
    "add_to_cart_button": "button[data-test^='add-to-cart']",
}
```

## üîß Common Functions

### T·∫°o Test Data
```python
from utils.common_functions import CommonFunctions

# T·∫°o user test
user = CommonFunctions.generate_test_data("user")

# T·∫°o order test  
order = CommonFunctions.generate_test_data("order")

# T·∫°o product test
product = CommonFunctions.generate_test_data("product")
```

### Screenshot v·ªõi Metadata
```python
# Ch·ª•p screenshot v·ªõi th√¥ng tin
CommonFunctions.save_screenshot_with_metadata(
    page, 
    "test_screenshot.png",
    {"test_name": "login_test", "user": user}
)
```

### Retry Action
```python
# Th·ª±c hi·ªán action v·ªõi retry
CommonFunctions.retry_action(
    lambda: page.click("button"),
    max_retries=3,
    delay=1.0
)
```

## üåç Environment Configuration

### C·∫•u h√¨nh m√¥i tr∆∞·ªùng
```python
# config/settings.py
BASE_URL = "https://www.saucedemo.com/"
API_BASE_URL = "https://api.example.com"
GRPC_SERVER = "localhost:50051"
```

### Ch·∫°y v·ªõi m√¥i tr∆∞·ªùng kh√°c
```bash
# Staging
pytest --app-base-url=https://staging.example.com

# Production  
pytest --app-base-url=https://prod.example.com
```

## üîç Debug & Troubleshooting

### Xem log chi ti·∫øt
```bash
# Log ƒë∆∞·ª£c l∆∞u trong test.log
tail -f test.log
```

### Screenshot khi fail
- Screenshots t·ª± ƒë·ªông ƒë∆∞·ª£c l∆∞u trong th∆∞ m·ª•c `screenshots/`
- Metadata ƒë∆∞·ª£c l∆∞u k√®m theo file JSON
- Allure t·ª± ƒë·ªông attach screenshot v√†o report

### Ch·∫°y v·ªõi browser hi·ªÉn th·ªã
```bash
# M·∫∑c ƒë·ªãnh headless=False trong conftest.py
pytest tests/test_login_ui.py
```

## üìö Best Practices

### 1. Page Object Model
- T√°ch bi·ªát logic test v√† UI interaction
- S·ª≠ d·ª•ng selector t·∫≠p trung trong `locators.py`
- K·∫ø th·ª´a `BasePage` cho c√°c page m·ªõi

### 2. Test Data Management
- S·ª≠ d·ª•ng `CommonFunctions.generate_test_data()` cho d·ªØ li·ªáu ƒë·ªông
- Tr√°nh hardcode d·ªØ li·ªáu trong test

### 3. Error Handling
- S·ª≠ d·ª•ng `custom_assert()` thay v√¨ `assert` th√¥ng th∆∞·ªùng
- T·ª± ƒë·ªông ch·ª•p screenshot khi fail

### 4. Logging
- S·ª≠ d·ª•ng `log_test_info()` ƒë·ªÉ log th√¥ng tin test
- Log ƒë∆∞·ª£c l∆∞u v√†o file v√† console

### 5. Allure Reporting
- S·ª≠ d·ª•ng `AllureReporter` cho step-by-step reporting
- Th√™m decorators ph√π h·ª£p cho test cases
- Attach screenshots v√† data v√†o report

## üöÄ Advanced Usage

### Parallel Execution
```bash
# C√†i ƒë·∫∑t
pip install pytest-xdist

# Ch·∫°y song song
pytest -n auto
```

### Custom Fixtures
```python
# conftest.py
@pytest.fixture
def test_user():
    return CommonFunctions.generate_test_data("user")
```

### BaseTest Class
```python
# K·∫ø th·ª´a BaseTest cho test class
class TestLogin(BaseTest):
    def test_login_quick(self, page):
        self.login_quick(page, "username", "password")
```

### Allure Environment Variables
```bash
# T·∫°o file environment.properties
echo "Browser=Chrome" > allure-results/environment.properties
echo "Version=1.0.0" >> allure-results/environment.properties
echo "Platform=macOS" >> allure-results/environment.properties
```

## üìû Support

- **Documentation**: Xem comments trong code
- **Issues**: Ki·ªÉm tra log file `test.log`
- **Screenshots**: Xem th∆∞ m·ª•c `screenshots/` khi test fail
- **Allure Report**: Xem step-by-step execution trong Allure

## üîÑ Updates

Framework ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ d·ªÖ m·ªü r·ªông:
- Th√™m page objects m·ªõi trong `pages/`
- Th√™m test cases m·ªõi trong `tests/`
- Th√™m common functions trong `utils/common_functions.py`
- Th√™m Allure helpers trong `utils/allure_helpers.py`
- C·∫≠p nh·∫≠t selectors trong `pages/locators.py`

## üéØ **Allure Report Features (nh∆∞ ZaloPay)**

### Step-by-Step Execution
- M·ªói action ƒë∆∞·ª£c log th√†nh step ri√™ng bi·ªát
- Screenshots t·ª± ƒë·ªông cho m·ªói step quan tr·ªçng
- Timeline view cho to√†n b·ªô test execution

### Rich Attachments
- Screenshots v·ªõi metadata
- API request/response data
- Test data v√† environment info
- Error details v√† stack traces

### Analytics & Trends
- Test execution trends
- Failure analysis
- Performance metrics
- Environment comparison

### Integration Ready
- JIRA integration
- Slack notifications
- CI/CD pipeline support
- Custom dashboards 